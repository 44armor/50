<!doctype html>
<html lang="zh-TW">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>é™¸è»å®˜æ ¡å››åå››æœŸè£ç”²å…µç•¢æ¥­50é€±å¹´ç´€å¿µ - ç•™è¨€æ¿</title>
	<link rel='stylesheet' href='style.css' media='all' />
	<link rel='preconnect' href='https://fonts.gstatic.com/' crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
	<script async src="https://www.googletagmanager.com/gtag/js?id=GT-55XG78ZJ"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	  gtag('config', 'GT-55XG78ZJ');
	</script>
</head>
<body>

	<div class="sidebar-overlay" id="sidebarOverlay"></div>

	<header class="site-header">
		<div class="container header-content">
			<h1 class="site-title"><a href="index.html">é™¸è»è»å®˜å­¸æ ¡å››åå››æœŸè£ç”²å…µç•¢æ¥­äº”åå‘¨å¹´ç´€å¿µå†Š</a></h1>
			<button class="menu-toggle" aria-label="é¸å–®åˆ‡æ›">â˜°</button>
		</div>
	</header>

	<main class="site-main container">
		<aside class="site-sidebar">
			<nav class="sidebar-navigation">
				<a href="index.html">å°é¢</a>
				<a href="inner-cover.html">å°é¢å…§é </a>
				<a href="preface.html">åºè¨€</a>
				<a href="greetings.html">è³€è©</a>
				<a href="catalog.html">ç›®éŒ„</a>
				<a href="memories.html">è¿°æ‡·</a>
				<a href="biography.html">ç”Ÿå¹³è¨˜è¦</a>
				<a href="photo-album.html">ç´€å¿µåœ–å†Š</a>
				<a href="postscript.html">ç·¨è¼¯å¾Œè¨˜</a>
				<a href="copyright.html">ç‰ˆæ¬Šé </a>
				<a href="back-inner-cover.html">å°åº•å…§é </a>
				<a href="back-cover.html">å°åº•</a>
				<a href="guestbook.html" class="active">ç•™è¨€æ¿</a>
			</nav>
		</aside>

		<section class="main-content">
			<h2>ç•™è¨€æ¿</h2>
			<div class="guestbook-container">
				<!-- æ­¡è¿å€åŸŸ -->
				<div class="guestbook-welcome">
					<div class="welcome-icon">ğŸ’¬</div>
					<h3>æ­¡è¿ç•™ä¸‹æ‚¨çš„ç¥ç¦èˆ‡å›æ†¶</h3>
					<p>åœ¨é€™è£¡ï¼Œæ‚¨å¯ä»¥åˆ†äº«å°åŒå­¸å€‘çš„ç¥ç¦ã€å›æ†¶ç•¶å¹´çš„è»æ ¡ç”Ÿæ´»ï¼Œæˆ–æ˜¯å°é€™æ¬¡50é€±å¹´ç´€å¿µæ´»å‹•çš„æ„Ÿæƒ³ã€‚</p>
				</div>

				<!-- ç•™è¨€è¡¨å–® -->
				<div class="guestbook-form-section">
					<h3 class="section-title">ğŸ“ ç™¼è¡¨ç•™è¨€</h3>
					<form id="guestbook-form" class="guestbook-form">
						<div class="form-row">
							<div class="form-group">
								<label for="name">å§“å <span class="required">*</span></label>
								<input type="text" id="name" name="name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" required>
							</div>
							<div class="form-group">
								<label for="email">é›»å­éƒµä»¶</label>
								<input type="email" id="email" name="email" placeholder="é¸å¡«ï¼Œç”¨æ–¼è¯ç¹«">
							</div>
						</div>

						<div class="form-group">
							<label for="message">ç•™è¨€å…§å®¹ <span class="required">*</span></label>
							<textarea id="message" name="message" rows="5" placeholder="è«‹åˆ†äº«æ‚¨çš„ç¥ç¦ã€å›æ†¶æˆ–æ„Ÿæƒ³..." required></textarea>
							<div class="char-counter">
								<span id="char-count">0</span> / 500 å­—
							</div>
						</div>

						<div class="form-actions">
							<button type="button" class="clear-btn" onclick="clearForm()">æ¸…ç©º</button>
							<button type="submit" class="submit-btn">
								<span class="btn-icon">ğŸ“¤</span>
								æäº¤ç•™è¨€
							</button>
						</div>
					</form>
				</div>
				
				<!-- ç•™è¨€çµ±è¨ˆ -->
				<div class="guestbook-stats">
					<div class="stat-item">
						<span class="stat-number" id="total-messages">0</span>
						<span class="stat-label">ç¸½ç•™è¨€æ•¸</span>
					</div>
					<div class="stat-item">
						<span class="stat-number" id="today-messages">0</span>
						<span class="stat-label">ä»Šæ—¥ç•™è¨€</span>
					</div>
					<div class="stat-item">
						<span class="stat-number" id="unique-authors">0</span>
						<span class="stat-label">åƒèˆ‡äººæ•¸</span>
					</div>
				</div>

				<!-- ç•™è¨€åˆ—è¡¨ -->
				<div id="guestbook-messages" class="guestbook-messages">
					<div class="messages-header">
						<h3>ğŸ’­ ç•™è¨€åˆ—è¡¨</h3>
						<div class="messages-controls">
							<button class="sort-btn active" data-sort="newest">æœ€æ–°</button>
							<button class="sort-btn" data-sort="oldest">æœ€æ—©</button>
						</div>
					</div>
					<ul id="messages-list" class="messages-list">
						<!-- ç•™è¨€å°‡åœ¨é€™è£¡é¡¯ç¤º -->
					</ul>
				</div>
			</div>
		</section>
	</main>

	<footer class="site-footer">
		<div class="container">
			<p>è‘—ä½œæ¬Šæ‰€æœ‰ï¼Œä¸¦ä¿ç•™ä¸€åˆ‡æ¬Šåˆ©</p>
		</div>
	</footer>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
			const menuToggle = document.querySelector('.menu-toggle');
			const sidebarNavigation = document.querySelector('.sidebar-navigation');
			const sidebar = document.querySelector('.site-sidebar');
			const overlay = document.getElementById('sidebarOverlay');

			function closeSidebar() {
				sidebar.classList.remove('is-open');
				overlay.classList.remove('active');
				menuToggle.setAttribute('aria-expanded', 'false');
			}

			if (menuToggle && sidebarNavigation && sidebar && overlay) {
				menuToggle.addEventListener('click', function(e) {
					e.stopPropagation();
					sidebar.classList.toggle('is-open');
					overlay.classList.toggle('active', sidebar.classList.contains('is-open'));
					this.setAttribute('aria-expanded', sidebar.classList.contains('is-open'));
				});

				overlay.addEventListener('click', closeSidebar);

				sidebarNavigation.addEventListener('click', function(e) {
					if (e.target.tagName === 'A') {
						closeSidebar();
					}
				});
			}

			// ç•™è¨€æ¿åŠŸèƒ½
			const guestbookForm = document.getElementById('guestbook-form');
			const messagesList = document.getElementById('messages-list');
			const charCount = document.getElementById('char-count');
			const messageInput = document.getElementById('message');

			// å­—æ•¸è¨ˆæ•¸åŠŸèƒ½
			if (messageInput && charCount) {
				messageInput.addEventListener('input', function() {
					const length = this.value.length;
					charCount.textContent = length;
					
					if (length > 450) {
						charCount.style.color = '#dc3545';
					} else if (length > 400) {
						charCount.style.color = '#ffc107';
					} else {
						charCount.style.color = '#6c757d';
					}
				});
			}


			// Google Sheets API URL
			const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbwSKTcbLEebS1r48TvQnkkOFVsp4l26kL1wsl5-_ZBVAsMjUkQJcLTQ83rsMncafisp/exec';

			// è¼‰å…¥ç•™è¨€ï¼ˆå¾ Google Sheetsï¼‰
			function loadMessagesFromSheet() {
				fetch(SHEET_API_URL)
				  .then(res => res.json())
				  .then(messages => {
					messagesList.innerHTML = '';
					messages.reverse().forEach(msg => {
					  const li = createMessageElement(msg.name, msg.message, msg.date, msg.email);
					  messagesList.appendChild(li);
					});
					updateStats();
				  });
			}

			// åˆå§‹åŒ–è¼‰å…¥ç•™è¨€
			loadMessagesFromSheet();

			if (guestbookForm) {
				guestbookForm.addEventListener('submit', function(e) {
					e.preventDefault();
					const name = document.getElementById('name').value.trim();
					const email = document.getElementById('email').value.trim();
					const message = document.getElementById('message').value.trim();
					if (name && message) {
						fetch(SHEET_API_URL, {
							method: 'POST',
							body: JSON.stringify({ name, email, message }),
							headers: { 'Content-Type': 'application/json' }
						})
						.then(res => res.json())
						.then(() => {
							showNotification('ç•™è¨€æäº¤æˆåŠŸï¼', 'success');
							guestbookForm.reset();
							charCount.textContent = '0';
							loadMessagesFromSheet();
						})
						.catch(() => showNotification('ç•™è¨€æäº¤å¤±æ•—', 'error'));
					} else {
						showNotification('è«‹å¡«å¯«å§“åå’Œç•™è¨€å…§å®¹', 'error');
					}
				});
			}

			function createMessageElement(name, message, date, email) {
				const li = document.createElement('li');
				li.className = 'message-item';
				const displayName = name;
				const avatarText = name ? name.charAt(0) : '?';
				const dateString = date || (new Date().toLocaleDateString('zh-TW') + ' ' + new Date().toLocaleTimeString('zh-TW', {hour: '2-digit', minute: '2-digit'}));
				li.innerHTML = `
					<div class="message-avatar">${avatarText}</div>
					<div class="message-content-wrapper">
						<div class="message-header">
							<span class="message-author">${displayName}</span>
							<span class="message-date">${dateString}</span>
							${email ? `<span class='message-email' style='margin-left:8px;color:#888;font-size:0.9em;'>${email}</span>` : ''}
						</div>
						<div class="message-content">${message}</div>
						<div class="message-actions">
							<button class="action-btn like-btn" onclick="toggleLike(this)">
								<span class="action-icon">ğŸ‘</span>
								<span class="action-text">è®š</span>
							</button>
							<button class="action-btn reply-btn" onclick="showReplyForm(this)">
								<span class="action-icon">ğŸ’¬</span>
								<span class="action-text">å›è¦†</span>
							</button>
						</div>
					</div>
				`;
				return li;
			}

			function updateStats() {
				const totalMessages = document.querySelectorAll('.message-item').length;
				document.getElementById('total-messages').textContent = totalMessages;

				const todayMessages = Array.from(document.querySelectorAll('.message-item')).filter(li => {
					const messageDate = new Date(li.querySelector('.message-date').textContent);
					const today = new Date();
					return messageDate.toDateString() === today.toDateString();
				}).length;
				document.getElementById('today-messages').textContent = todayMessages;

				const uniqueAuthors = new Set(Array.from(document.querySelectorAll('.message-item')).map(li => li.querySelector('.message-author').textContent)).size;
				document.getElementById('unique-authors').textContent = uniqueAuthors;
			}

			function showNotification(message, type) {
				// å‰µå»ºé€šçŸ¥å…ƒç´ 
				const notification = document.createElement('div');
				notification.style.cssText = `
					position: fixed;
					top: 20px;
					right: 20px;
					padding: 15px 20px;
					border-radius: 8px;
					color: white;
					font-weight: 600;
					z-index: 1000;
					transform: translateX(100%);
					transition: transform 0.3s ease;
					background: ${type === 'success' ? '#28a745' : '#dc3545'};
				`;
				notification.textContent = message;
				
				document.body.appendChild(notification);
				
				// é¡¯ç¤ºé€šçŸ¥
				setTimeout(() => {
					notification.style.transform = 'translateX(0)';
				}, 100);
				
				// è‡ªå‹•éš±è—
				setTimeout(() => {
					notification.style.transform = 'translateX(100%)';
					setTimeout(() => {
						document.body.removeChild(notification);
					}, 300);
				}, 3000);
			}

			// æ’åºåŠŸèƒ½
			document.querySelectorAll('.sort-btn').forEach(button => {
				button.addEventListener('click', function() {
					const sortBy = this.dataset.sort;
					const messages = Array.from(messagesList.children);

					messages.sort((a, b) => {
						const dateA = new Date(a.querySelector('.message-date').textContent);
						const dateB = new Date(b.querySelector('.message-date').textContent);

						if (sortBy === 'newest') {
							return dateB - dateA; // æœ€æ–°åœ¨å‰
						} else {
							return dateA - dateB; // æœ€æ—©åœ¨å‰
						}
					});

					messages.forEach(message => messagesList.appendChild(message));
					this.classList.add('active');
					document.querySelectorAll('.sort-btn').forEach(btn => {
						if (btn !== this) {
							btn.classList.remove('active');
						}
					});
				});
			});

			// æ¸…ç©ºè¡¨å–®åŠŸèƒ½
			function clearForm() {
				document.getElementById('guestbook-form').reset();
				charCount.textContent = '0';
				showNotification('è¡¨å–®å·²æ¸…ç©º', 'info');
			}

			// å›è¦†åŠŸèƒ½ (ç¤ºä¾‹ï¼Œå¯¦éš›éœ€è¦æ›´è¤‡é›œçš„é‚è¼¯)
			function showReplyForm(button) {
				const messageItem = button.closest('.message-item');
				const replyForm = document.createElement('div');
				replyForm.className = 'reply-form';
				replyForm.innerHTML = `
					<div class="form-group">
						<label for="reply-name">å›è¦†è€…å§“å <span class="required">*</span></label>
						<input type="text" id="reply-name" name="reply-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å" required>
					</div>
					<div class="form-group">
						<label for="reply-message">å›è¦†å…§å®¹ <span class="required">*</span></label>
						<textarea id="reply-message" name="reply-message" rows="3" placeholder="è«‹è¼¸å…¥æ‚¨çš„å›è¦†..." required></textarea>
						<div class="char-counter">
							<span id="reply-char-count">0</span> / 200 å­—
						</div>
					</div>
					<div class="form-actions">
						<button type="button" class="clear-btn" onclick="clearReplyForm(replyForm)">æ¸…ç©º</button>
						<button type="submit" class="submit-btn">
							<span class="btn-icon">ğŸ“¤</span>
							æäº¤å›è¦†
						</button>
					</div>
				`;
				messageItem.appendChild(replyForm);

				const replyCharCount = document.getElementById('reply-char-count');
				const replyMessageInput = document.getElementById('reply-message');
				replyMessageInput.addEventListener('input', function() {
					replyCharCount.textContent = this.value.length;
				});

				replyForm.addEventListener('submit', function(e) {
					e.preventDefault();
					const replyName = document.getElementById('reply-name').value.trim();
					const replyMessage = document.getElementById('reply-message').value.trim();

					if (replyName && replyMessage) {
						const newReply = createReplyElement(replyName, replyMessage);
						messageItem.appendChild(newReply);
						replyCharCount.textContent = '0';
						showNotification('å›è¦†æäº¤æˆåŠŸï¼', 'success');
					} else {
						showNotification('è«‹å¡«å¯«å›è¦†è€…å§“åå’Œå›è¦†å…§å®¹', 'error');
					}
				});
			}

			function createReplyElement(name, message) {
				const li = document.createElement('li');
				li.className = 'reply-item';
				li.innerHTML = `
					<div class="reply-header">
						<span class="reply-author">${name}</span>
						<span class="reply-date">${new Date().toLocaleDateString('zh-TW') + ' ' + new Date().toLocaleTimeString('zh-TW', {hour: '2-digit', minute: '2-digit'})}</span>
					</div>
					<div class="reply-content">${message}</div>
				`;
				return li;
			}

			function clearReplyForm(form) {
				form.reset();
				document.getElementById('reply-char-count').textContent = '0';
				showNotification('å›è¦†è¡¨å–®å·²æ¸…ç©º', 'info');
			}

			// é»è®šåŠŸèƒ½ (ç¤ºä¾‹ï¼Œå¯¦éš›éœ€è¦æ›´è¤‡é›œçš„é‚è¼¯)
			function toggleLike(button) {
				const likeIcon = button.querySelector('.action-icon');
				const likeText = button.querySelector('.action-text');
				const originalIcon = likeIcon.textContent;
				const originalText = likeText.textContent;

				if (likeIcon.textContent === 'ğŸ‘') {
					likeIcon.textContent = 'ğŸ‘';
					likeText.textContent = 'å–æ¶ˆè®š';
					showNotification('æ‚¨å·²å–æ¶ˆè®šï¼', 'info');
				} else {
					likeIcon.textContent = 'ğŸ‘';
					likeText.textContent = 'è®š';
					showNotification('æ‚¨å·²é»è®šï¼', 'success');
				}
			}
		});
	</script>

</body>
</html>
